class CommunitiesTest < Test::Unit::TestCase
  def setup
    @dataset = Datasets::Communities.new
  end

  def record(*args)
    Datasets::Communities::Record.new(*args)
  end

  test('#each') do
    records = @dataset.each.to_a
    assert_equal([
                    1994,
                    {
                      :state => 8,
                      :county => nil,
                      :community => nil,
                      :community_name => "Lakewoodcity",
                      :fold => 1,
                      :population => 0.19,
                      :household_size => 0.33,
                      :race_percent_black => 0.02,
                      :race_percent_white => 0.9,
                      :race_percent_asian => 0.12,
                      :race_percent_hisp => 0.17,
                      :age_percent_12_to_21 => 0.34,
                      :age_percent_12_to_29 => 0.47,
                      :age_percent_16_to_24 => 0.29,
                      :age_percent_65_and_upper => 0.32,
                      :n_urban => 0.2,
                      :percent_urban => 1,
                      :median_income => 0.37,
                      :percent_with_wage => 0.72,
                      :percent_with_farm_self => 0.34,
                      :percent_with_investment_income => 0.6,
                      :percent_with_social_security => 0.29,
                      :percent_with_public_assistant => 0.15,
                      :percent_with_retire => 0.43,
                      :med_fam_income => 0.39,
                      :per_capita_income => 0.4,
                      :white_per_capita => 0.39,
                      :black_per_capita => 0.32,
                      :indian_per_capita => 0.27,
                      :asian_per_capita => 0.27,
                      :other_per_capita => 0.36,
                      :hisp_per_capita => 0.41,
                      :num_under_pov => 0.08,
                      :percent_pop_under_pov => 0.19,
                      :percent_less9th_grade => 0.1,
                      :percent_not_hs_grad => 0.18,
                      :percent_b_sor_more => 0.48,
                      :percent_unemployed => 0.27,
                      :percent_employ => 0.68,
                      :percent_empl_manu => 0.23,
                      :percent_empl_prof_serv => 0.41,
                      :percent_occup_manu => 0.25,
                      :percent_occup_mgmt_prof => 0.52,
                      :male_percent_divorce => 0.68,
                      :male_percent_nev_marr => 0.4,
                      :female_percent_div => 0.75,
                      :total_percent_div => 0.75,
                      :pers_per_fam => 0.35,
                      :percent_fam2_par => 0.55,
                      :percent_kids2_par => 0.59,
                      :percent_young_kids2_par => 0.61,
                      :percent_teen2_par => 0.56,
                      :percent_work_mom => 0.76,
                      :percent_work_mom_young_kids => 0.74,
                      :num_illeg => 0.04,
                      :percent_illeg => 0.14,
                      :num_immig => 0.03,
                      :percent_immig_recent => 0.24,
                      :percent_immig_rec5 => 0.27,
                      :percent_immig_rec8 => 0.37,
                      :percent_immig_rec10 => 0.39,
                      :percent_recent_immig => 0.07,
                      :percent_rec_immig5 => 0.07,
                      :percent_rec_immig8 => 0.08,
                      :percent_rec_immig10 => 0.08,
                      :percent_speak_engl_only => 0.89,
                      :percent_not_speak_engl_well => 0.06,
                      :percent_larg_house_fam => 0.14,
                      :percent_larg_house_occup => 0.13,
                      :pers_per_occup_hous => 0.33,
                      :pers_per_own_occ_hous => 0.39,
                      :pers_per_rent_occ_hous => 0.28,
                      :percent_pers_own_occup => 0.55,
                      :percent_pers_dense_hous => 0.09,
                      :percent_hous_less3_br => 0.51,
                      :med_num_br => 0.5,
                      :hous_vacant => 0.21,
                      :percent_hous_occup => 0.71,
                      :percent_hous_own_occ => 0.52,
                      :percent_vacant_boarded => 0.05,
                      :percent_vac_more6_mos => 0.26,
                      :med_yr_hous_built => 0.65,
                      :percent_hous_no_phone => 0.14,
                      :percent_wo_full_plumb => 0.06,
                      :own_occ_low_quart => 0.22,
                      :own_occ_med_val => 0.19,
                      :own_occ_hi_quart => 0.18,
                      :rent_low_q => 0.36,
                      :rent_median => 0.35,
                      :rent_high_q => 0.38,
                      :med_rent => 0.34,
                      :med_rent_percent_hous_income => 0.38,
                      :med_own_cost_percent_income => 0.46,
                      :med_own_cost_percent_income_no_mtg => 0.25,
                      :num_in_shelters => 0.04,
                      :num_street => 0,
                      :percent_foreign_born => 0.12,
                      :percent_born_same_state => 0.42,
                      :percent_same_house85 => 0.5,
                      :percent_same_city85 => 0.51,
                      :percent_same_state85 => 0.64,
                      :lemas_sworn_ft => 0.03,
                      :lemas_sw_ft_per_pop => 0.13,
                      :lemas_sw_ft_field_ops => 0.96,
                      :lemas_sw_ft_field_per_pop => 0.17,
                      :lemas_total_req => 0.06,
                      :lemas_tot_req_per_pop => 0.18,
                      :polic_req_per_offic => 0.44,
                      :polic_per_pop => 0.13,
                      :racial_match_comm_pol => 0.94,
                      :percent_polic_white => 0.93,
                      :percent_polic_black => 0.03,
                      :percent_polic_hisp => 0.07,
                      :percent_polic_asian => 0.1,
                      :percent_polic_minor => 0.07,
                      :offic_assgn_drug_units => 0.02,
                      :num_kinds_drugs_seiz => 0.57,
                      :polic_ave_ot_worked => 0.29,
                      :land_area => 0.12,
                      :pop_dens => 0.26,
                      :percent_use_pub_trans => 0.2,
                      :polic_cars => 0.06,
                      :polic_oper_budg => 0.04,
                      :lemas_percent_polic_on_patr => 0.9,
                      :lemas_gang_unit_deploy => 0.5,
                      :lemas_percent_offic_drug_un => 0.32,
                      :polic_budg_per_pop => 0.14,
                      :violent_crimes_per_pop => 0.2,
                    },
                    {
                      :state => 6,
                      :county => nil,
                      :community => nil,
                      :community_name => "Ontariocity",
                      :fold => 10,
                      :population => 0.2,
                      :household_size => 0.78,
                      :race_percent_black => 0.14,
                      :race_percent_white => 0.46,
                      :race_percent_asian => 0.24,
                      :race_percent_hisp => 0.77,
                      :age_percent_12_to_21 => 0.5,
                      :age_percent_12_to_29 => 0.62,
                      :age_percent_16_to_24 => 0.4,
                      :age_percent_65_and_upper => 0.17,
                      :n_urban => 0.21,
                      :percent_urban => 1,
                      :median_income => 0.4,
                      :percent_with_wage => 0.73,
                      :percent_with_farm_self => 0.22,
                      :percent_with_investment_income => 0.25,
                      :percent_with_social_security => 0.26,
                      :percent_with_public_assistant => 0.47,
                      :percent_with_retire => 0.29,
                      :med_fam_income => 0.36,
                      :per_capita_income => 0.24,
                      :white_per_capita => 0.28,
                      :black_per_capita => 0.32,
                      :indian_per_capita => 0.22,
                      :asian_per_capita => 0.27,
                      :other_per_capita => 0.25,
                      :hisp_per_capita => 0.29,
                      :num_under_pov => 0.16,
                      :percent_pop_under_pov => 0.35,
                      :percent_less9th_grade => 0.5,
                      :percent_not_hs_grad => 0.55,
                      :percent_b_sor_more => 0.16,
                      :percent_unemployed => 0.47,
                      :percent_employ => 0.58,
                      :percent_empl_manu => 0.53,
                      :percent_empl_prof_serv => 0.2,
                      :percent_occup_manu => 0.6,
                      :percent_occup_mgmt_prof => 0.24,
                      :male_percent_divorce => 0.49,
                      :male_percent_nev_marr => 0.5,
                      :female_percent_div => 0.6,
                      :total_percent_div => 0.57,
                      :pers_per_fam => 0.86,
                      :percent_fam2_par => 0.61,
                      :percent_kids2_par => 0.59,
                      :percent_young_kids2_par => 0.64,
                      :percent_teen2_par => 0.6,
                      :percent_work_mom_young_kids => 0.35,
                      :percent_work_mom => 0.35,
                      :num_illeg => 0.11,
                      :percent_illeg => 0.43,
                      :num_immig => 0.2,
                      :percent_immig_recent => 0.43,
                      :percent_immig_rec5 => 0.52,
                      :percent_immig_rec8 => 0.58,
                      :percent_immig_rec10 => 0.65,
                      :percent_recent_immig => 0.68,
                      :percent_rec_immig5 => 0.73,
                      :percent_rec_immig8 => 0.73,
                      :percent_rec_immig10 => 0.75,
                      :percent_speak_engl_only => 0.35,
                      :percent_not_speak_engl_well => 0.77,
                      :percent_larg_house_fam => 0.84,
                      :percent_larg_house_occup => 0.83,
                      :pers_per_occup_hous => 0.84,
                      :pers_per_own_occ_hous => 0.78,
                      :pers_per_rent_occ_hous => 0.89,
                      :percent_pers_own_occup => 0.46,
                      :percent_pers_dense_hous => 0.76,
                      :percent_hous_less3_br => 0.55,
                      :med_num_br => 0,
                      :hous_vacant => 0.12,
                      :percent_hous_occup => 0.8,
                      :percent_hous_own_occ => 0.49,
                      :percent_vacant_boarded => 0.1,
                      :percent_vac_more6_mos => 0.16,
                      :med_yr_hous_built => 0.71,
                      :percent_hous_no_phone => 0.32,
                      :percent_wo_full_plumb => 0.21,
                      :own_occ_low_quart => 0.35,
                      :own_occ_med_val => 0.35,
                      :own_occ_hi_quart => 0.32,
                      :rent_low_q => 0.54,
                      :rent_median => 0.53,
                      :rent_high_q => 0.61,
                      :med_rent => 0.54,
                      :med_rent_percent_hous_income => 0.69,
                      :med_own_cost_percent_income => 0.73,
                      :med_own_cost_percent_income_no_mtg => 0.21,
                      :num_in_shelters => 0.08,
                      :num_street => 0.08,
                      :percent_foreign_born => 0.68,
                      :percent_born_same_state => 0.5,
                      :percent_same_house85 => 0.34,
                      :percent_same_city85 => 0.35,
                      :percent_same_state85 => 0.68,
                      :lemas_sworn_ft => 0.03,
                      :lemas_sw_ft_per_pop => 0.11,
                      :lemas_sw_ft_field_ops => 0.96,
                      :lemas_sw_ft_field_per_pop => 0.14,
                      :lemas_total_req => 0.04,
                      :lemas_tot_req_per_pop => 0.11,
                      :polic_req_per_offic => 0.3,
                      :polic_per_pop => 0.11,
                      :racial_match_comm_pol => 0.45,
                      :percent_polic_white => 0.74,
                      :percent_polic_black => 0.34,
                      :percent_polic_hisp => 0.07,
                      :percent_polic_asian => 0,
                      :percent_polic_minor => 0.28,
                      :offic_assgn_drug_units => 0.07,
                      :num_kinds_drugs_seiz => 0.36,
                      :polic_ave_ot_worked => 0.11,
                      :land_area => 0.11,
                      :pop_dens => 0.3,
                      :percent_use_pub_trans => 0.05,
                      :polic_cars => 0.08,
                      :polic_oper_budg => 0.04,
                      :lemas_percent_polic_on_patr => 0.73,
                      :lemas_gang_unit_deploy => 0.5,
                      :lemas_percent_offic_drug_un => 1,
                      :polic_budg_per_pop => 0.13,
                      :violent_crimes_per_pop => 0.48
                    },
                 ],
                 [
                    records.size,
                    records[0].to_h,
                    records[-1].to_h
                 ])
  end

  sub_test_case("#metadata") do
    test("#description") do
      description = @dataset.metadata.description
      assert do
        description.start_with?("Title: Communities and Crime")
      end
    end
  end
end
